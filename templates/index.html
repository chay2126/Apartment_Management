<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apartment Management System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="home-page">
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-content">
                <div class="hero-icon">üè¢</div>
                <h1 class="hero-title">Apartment Management</h1>
                <p class="hero-subtitle">Your Complete Solution for Apartment Administration</p>
            </div>
        </div>
        
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="showTab('home')">
                <span class="tab-icon">üè†</span> Home
            </button>
            <button class="tab-btn" onclick="showTab('notices')">
                <span class="tab-icon">üìã</span> Notice Board
            </button>
        </div>
        
        <!-- Main Content -->
        <div class="home-content">
            <!-- Home Tab Content -->
            <div id="home-tab" class="tab-content active">
                <div class="welcome-card">
                    <h2>Welcome Back! üëã</h2>
                    <p>Manage your apartment with ease using our comprehensive tools</p>
                </div>
                
                <!-- Feature Cards Grid -->
                <div class="feature-grid">
                    <!-- Maintenance Card -->
                    <a href="/maintenance" class="feature-card maintenance-card">
                        <div class="feature-card-icon">üí∞</div>
                        <div class="feature-card-content">
                            <h3>Maintenance</h3>
                            <p>Track payments, view dues, and manage collections</p>
                        </div>
                        <div class="feature-card-arrow">‚Üí</div>
                    </a>
                    
                    <!-- Expenses Card -->
                    <a href="/expenses" class="feature-card expenses-card">
                        <div class="feature-card-icon">üìä</div>
                        <div class="feature-card-content">
                            <h3>Expenses</h3>
                            <p>Monitor apartment expenses and monthly budgets</p>
                        </div>
                        <div class="feature-card-arrow">‚Üí</div>
                    </a>
                    
                    <!-- Notify Watchman Card -->
                    <a href="/notify" class="feature-card notify-card">
                        <div class="feature-card-icon">üì±</div>
                        <div class="feature-card-content">
                            <h3>Notify Watchman</h3>
                            <p>Send instant notifications to apartment watchman</p>
                        </div>
                        <div class="feature-card-arrow">‚Üí</div>
                    </a>
                    
                    <!-- Services Card -->
                    <a href="/services" class="feature-card services-card">
                        <div class="feature-card-icon">üîß</div>
                        <div class="feature-card-content">
                            <h3>Services</h3>
                            <p>Quick access to all service provider contacts</p>
                        </div>
                        <div class="feature-card-arrow">‚Üí</div>
                    </a>
                </div>
                
                <!-- Quick Stats Section -->
                <div class="quick-stats">
                    <div class="stat-card">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-content">
                            <h4>Quick Access</h4>
                            <p>All features at your fingertips</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">‚ö°</div>
                        <div class="stat-content">
                            <h4>Real-time Updates</h4>
                            <p>Live data synchronization</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üîí</div>
                        <div class="stat-content">
                            <h4>Secure & Reliable</h4>
                            <p>Your data is safe with us</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Notice Board Tab Content -->
            <div id="notices-tab" class="tab-content">
                <div class="notices-container">
                    <div class="notices-header">
                        <h2>üìã Notice Board</h2>
                        <button onclick="showAddNoticeForm()" class="btn-add-notice">
                            <span>‚ûï</span> Add New Notice
                        </button>
                    </div>
                    
                    <!-- Add Notice Form (Hidden by default) -->
                    <div class="notice-form-container" id="addNoticeForm" style="display: none;">
                        <h3>Create New Notice</h3>
                        <form method="POST" action="/notices/add">
                            <div class="notice-form-grid">
                                <div class="form-group">
                                    <label for="notice_title">üìå Title</label>
                                    <input type="text" id="notice_title" name="title" class="form-input" 
                                           placeholder="Enter notice title" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="notice_category">üè∑Ô∏è Category</label>
                                    <select id="notice_category" name="category" class="form-input">
                                        <option value="General">General</option>
                                        <option value="Maintenance">Maintenance</option>
                                        <option value="Events">Events</option>
                                        <option value="Rules">Rules</option>
                                        <option value="Utilities">Utilities</option>
                                        <option value="Emergency">Emergency</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="notice_priority">‚ö° Priority</label>
                                    <select id="notice_priority" name="priority" class="form-input">
                                        <option value="Low">Low</option>
                                        <option value="Medium">Medium</option>
                                        <option value="High">High</option>
                                        <option value="Urgent">Urgent</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="notice_content">üìù Notice Content</label>
                                <textarea id="notice_content" name="content" class="form-textarea" 
                                          rows="5" placeholder="Enter notice details..." required></textarea>
                            </div>
                            
                            <div class="form-buttons">
                                <button type="submit" class="btn-submit">Post Notice</button>
                                <button type="button" onclick="hideAddNoticeForm()" class="btn-cancel">Cancel</button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Notices Grid -->
                    <div class="notices-grid" id="noticesGrid">
                        <p class="loading-text">Loading notices...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="home-footer">
            <p>¬© 2025 Apartment Management System. Built with ‚ù§Ô∏è</p>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            if (tabName === 'home') {
                document.getElementById('home-tab').classList.add('active');
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
            } else if (tabName === 'notices') {
                document.getElementById('notices-tab').classList.add('active');
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                loadNotices();
            }
        }
        
        // Load notices
        async function loadNotices() {
            try {
                const response = await fetch('/api/notices');
                const notices = await response.json();
                
                const noticesGrid = document.getElementById('noticesGrid');
                
                if (notices.length === 0) {
                    noticesGrid.innerHTML = `
                        <div class="empty-notices">
                            <div class="empty-icon">üì≠</div>
                            <h3>No Notices Posted</h3>
                            <p>Click "Add New Notice" to create your first announcement</p>
                        </div>
                    `;
                    return;
                }
                
                noticesGrid.innerHTML = notices.map(notice => `
                    <div class="notice-card priority-${notice.priority.toLowerCase()}">
                        <div class="notice-card-header">
                            <span class="notice-category ${notice.category.toLowerCase()}">${notice.category}</span>
                            <span class="notice-priority priority-${notice.priority.toLowerCase()}">${notice.priority}</span>
                        </div>
                        
                        <h3 class="notice-title">${notice.title}</h3>
                        <p class="notice-content">${notice.content}</p>
                        
                        <div class="notice-footer">
                            <span class="notice-date">üìÖ ${new Date(notice.created_date).toLocaleDateString()}</span>
                            <div class="notice-actions">
                                <button onclick="editNotice(${notice.notice_id}, '${notice.title.replace(/'/g, "\\'")}', '${notice.content.replace(/'/g, "\\'")}', '${notice.category}', '${notice.priority}')" class="btn-edit-notice">
                                    ‚úèÔ∏è Edit
                                </button>
                                <button onclick="deleteNotice(${notice.notice_id})" class="btn-delete-notice">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                        
                        <!-- Edit Form (Hidden) -->
                        <div id="edit-form-${notice.notice_id}" class="notice-edit-form" style="display: none;">
                            <form method="POST" action="/notices/edit/${notice.notice_id}">
                                <div class="form-group">
                                    <label>üìå Title</label>
                                    <input type="text" name="title" value="${notice.title}" class="form-input" required>
                                </div>
                                
                                <div class="notice-form-grid">
                                    <div class="form-group">
                                        <label>üè∑Ô∏è Category</label>
                                        <select name="category" class="form-input">
                                            <option value="General" ${notice.category === 'General' ? 'selected' : ''}>General</option>
                                            <option value="Maintenance" ${notice.category === 'Maintenance' ? 'selected' : ''}>Maintenance</option>
                                            <option value="Events" ${notice.category === 'Events' ? 'selected' : ''}>Events</option>
                                            <option value="Rules" ${notice.category === 'Rules' ? 'selected' : ''}>Rules</option>
                                            <option value="Utilities" ${notice.category === 'Utilities' ? 'selected' : ''}>Utilities</option>
                                            <option value="Emergency" ${notice.category === 'Emergency' ? 'selected' : ''}>Emergency</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>‚ö° Priority</label>
                                        <select name="priority" class="form-input">
                                            <option value="Low" ${notice.priority === 'Low' ? 'selected' : ''}>Low</option>
                                            <option value="Medium" ${notice.priority === 'Medium' ? 'selected' : ''}>Medium</option>
                                            <option value="High" ${notice.priority === 'High' ? 'selected' : ''}>High</option>
                                            <option value="Urgent" ${notice.priority === 'Urgent' ? 'selected' : ''}>Urgent</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>üìù Content</label>
                                    <textarea name="content" class="form-textarea" rows="4" required>${notice.content}</textarea>
                                </div>
                                
                                <div class="form-buttons">
                                    <button type="submit" class="btn-submit">Update Notice</button>
                                    <button type="button" onclick="cancelEdit(${notice.notice_id})" class="btn-cancel">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading notices:', error);
                document.getElementById('noticesGrid').innerHTML = `
                    <div class="error-message">
                        <p>Failed to load notices. Please refresh the page.</p>
                    </div>
                `;
            }
        }
        
        function showAddNoticeForm() {
            document.getElementById('addNoticeForm').style.display = 'block';
        }
        
        function hideAddNoticeForm() {
            document.getElementById('addNoticeForm').style.display = 'none';
        }
        
        function editNotice(id, title, content, category, priority) {
            const editForm = document.getElementById(`edit-form-${id}`);
            editForm.style.display = editForm.style.display === 'none' ? 'block' : 'none';
        }
        
        function cancelEdit(id) {
            document.getElementById(`edit-form-${id}`).style.display = 'none';
        }
        
        async function deleteNotice(id) {
            if (!confirm('Are you sure you want to delete this notice?')) return;
            
            try {
                const response = await fetch(`/notices/delete/${id}`, { method: 'POST' });
                if (response.ok) {
                    loadNotices();
                }
            } catch (error) {
                console.error('Error deleting notice:', error);
                alert('Failed to delete notice');
            }
        }
        
        // Load notices when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we should show notices tab (e.g., after form submission)
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('tab') === 'notices') {
                showTab('notices');
            }
        });
    </script>
</body>
</html>
