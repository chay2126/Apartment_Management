<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notify Watchman - Apartment Management</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <a href="/" class="back-button">â† Back to Home</a>
        
        <div class="page-header">
            <h1>Notify Watchman</h1>
            <p class="subtitle">Send instant Telegram notification</p>
        </div>
        
        <!-- Notification Status Messages -->
        {% if success %}
        <div class="alert alert-success">
            <div class="alert-icon">âœ…</div>
            <div class="alert-content">
                <h3>Notification Sent Successfully!</h3>
                <p>Telegram message has been sent to the watchman from Flat {{ flat_no }}.</p>
            </div>
        </div>
        {% endif %}
        
        {% if error %}
        <div class="alert alert-error">
            <div class="alert-icon">âŒ</div>
            <div class="alert-content">
                <h3>Notification Failed</h3>
                <p>{{ error }}</p>
            </div>
        </div>
        {% endif %}
        
        <!-- Notification Form -->
        <div class="notify-form-container">
            <div class="notify-icon-large">ğŸ“±</div>
            
            <form method="POST" action="/notify/send" class="notify-form">
                <div class="form-group">
                    <label for="flat_no">
                        <span class="label-icon">ğŸ </span>
                        Your Flat Number
                    </label>
                    <input type="text" id="flat_no" name="flat_no" class="form-input" 
                           placeholder="e.g., 301" required pattern="[0-9A-Za-z]+" 
                           title="Please enter a valid flat number">
                </div>
                
                <div class="form-group">
                    <label for="message_type">
                        <span class="label-icon">ğŸ“</span>
                        Reason
                    </label>
                    <select id="message_type" name="message_type" class="form-input" onchange="updateMessage()">
                        <option value="general">General Call</option>
                        <option value="urgent">Urgent Assistance</option>
                        <option value="delivery">Delivery/Guest Arrival</option>
                        <option value="maintenance">Maintenance Issue</option>
                        <option value="security">Security Concern</option>
                        <option value="custom">Custom Message</option>
                    </select>
                </div>
                
                <div class="form-group" id="custom_message_group" style="display: none;">
                    <label for="custom_message">
                        <span class="label-icon">âœï¸</span>
                        Custom Message
                    </label>
                    <textarea id="custom_message" name="custom_message" class="form-textarea" 
                              rows="3" placeholder="Enter your custom message..."></textarea>
                </div>
                
                <div class="message-preview">
                    <h4>ğŸ“© Message Preview:</h4>
                    <div class="preview-box" id="message_preview">
                        ğŸ”” Alert: Flat <span id="preview_flat">___</span> is calling you. Please visit immediately.
                    </div>
                </div>
                
                <div class="form-buttons">
                    <button type="submit" class="btn-send-notification">
                        <span>ğŸ“¤</span> Send Telegram Notification
                    </button>
                    <a href="/" class="btn-cancel">Cancel</a>
                </div>
            </form>
            
            <div class="info-note">
                <strong>Note:</strong> This will send an instant notification to the watchman's Telegram app. 
                Make sure the watchman has started the bot and Telegram is installed on their phone.
            </div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        function updateMessage() {
            const flatNo = document.getElementById('flat_no').value || '___';
            const messageType = document.getElementById('message_type').value;
            const customGroup = document.getElementById('custom_message_group');
            const preview = document.getElementById('message_preview');
            const previewFlat = document.getElementById('preview_flat');
            
            previewFlat.textContent = flatNo;
            
            const messages = {
                'general': `ğŸ”” Alert: Flat ${flatNo} is calling you. Please visit immediately.`,
                'urgent': `ğŸš¨ URGENT: Flat ${flatNo} needs immediate assistance. Please rush!`,
                'delivery': `ğŸ“¦ Delivery Alert: Guest/Delivery at Flat ${flatNo}. Please attend.`,
                'maintenance': `ğŸ”§ Maintenance: Flat ${flatNo} needs maintenance support. Please visit.`,
                'security': `ğŸš¨ Security Alert: Flat ${flatNo} requires security assistance. Please respond immediately.`,
                'custom': 'Custom message will be sent'
            };
            
            if (messageType === 'custom') {
                customGroup.style.display = 'block';
                preview.textContent = 'Your custom message will be sent';
            } else {
                customGroup.style.display = 'none';
                preview.textContent = messages[messageType];
            }
        }
        
        // Update preview when flat number changes
        document.getElementById('flat_no').addEventListener('input', updateMessage);
    </script>
</body>
</html>
